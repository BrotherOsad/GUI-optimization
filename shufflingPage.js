/*! For license information please see shufflingPage.js.LICENSE.txt */
(()=>{var e,t,n,o,r={61:(e,t,n)=>{var o=n(698).default;function r(){"use strict";e.exports=r=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},n=Object.prototype,a=n.hasOwnProperty,s=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function h(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(e){h=function(e,t,n){return e[t]=n}}function d(e,t,n,o){var r=t&&t.prototype instanceof y?t:y,a=Object.create(r.prototype),i=new A(o||[]);return s(a,"_invoke",{value:I(e,n,i)}),a}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var p={};function y(){}function v(){}function m(){}var g={};h(g,u,(function(){return this}));var b=Object.getPrototypeOf,w=b&&b(b(V([])));w&&w!==n&&a.call(w,u)&&(g=w);var x=m.prototype=y.prototype=Object.create(g);function k(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function n(r,s,i,u){var c=f(e[r],e,s);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==o(h)&&a.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,i,u)}),(function(e){n("throw",e,i,u)})):t.resolve(h).then((function(e){l.value=e,i(l)}),(function(e){return n("throw",e,i,u)}))}u(c.arg)}var r;s(this,"_invoke",{value:function(e,o){function a(){return new t((function(t,r){n(e,o,t,r)}))}return r=r?r.then(a,a):a()}})}function I(e,t,n){var o="suspendedStart";return function(r,a){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===r)throw a;return{value:void 0,done:!0}}for(n.method=r,n.arg=a;;){var s=n.delegate;if(s){var i=P(s,n);if(i){if(i===p)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===o)throw o="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o="executing";var u=f(e,t,n);if("normal"===u.type){if(o=n.done?"completed":"suspendedYield",u.arg===p)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o="completed",n.method="throw",n.arg=u.arg)}}}function P(e,t){var n=t.method,o=e.iterator[n];if(void 0===o)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,P(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),p;var r=f(o,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,p;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function V(e){if(e){var t=e[u];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(a.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:R}}function R(){return{value:void 0,done:!0}}return v.prototype=m,s(x,"constructor",{value:m,configurable:!0}),s(m,"constructor",{value:v,configurable:!0}),v.displayName=h(m,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,h(e,l,"GeneratorFunction")),e.prototype=Object.create(x),e},t.awrap=function(e){return{__await:e}},k(T.prototype),h(T.prototype,c,(function(){return this})),t.AsyncIterator=T,t.async=function(e,n,o,r,a){void 0===a&&(a=Promise);var s=new T(d(e,n,o,r),a);return t.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},k(x),h(x,l,"Generator"),h(x,u,(function(){return this})),h(x,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var o in t)n.push(o);return n.reverse(),function e(){for(;n.length;){var o=n.pop();if(o in t)return e.value=o,e.done=!1,e}return e.done=!0,e}},t.values=V,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,o){return s.type="throw",s.arg=e,t.next=n,o&&(t.method="next",t.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o],s=r.completion;if("root"===r.tryLoc)return n("end");if(r.tryLoc<=this.prev){var i=a.call(r,"catchLoc"),u=a.call(r,"finallyLoc");if(i&&u){if(this.prev<r.catchLoc)return n(r.catchLoc,!0);if(this.prev<r.finallyLoc)return n(r.finallyLoc)}else if(i){if(this.prev<r.catchLoc)return n(r.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return n(r.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&a.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var s=r?r.completion:{};return s.type=e,s.arg=t,r?(this.method="next",this.next=r.finallyLoc,p):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var o=n.completion;if("throw"===o.type){var r=o.arg;O(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:V(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},t}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},698:e=>{function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},687:(e,t,n)=>{var o=n(61)();e.exports=o;try{regeneratorRuntime=o}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=o:Function("r","regeneratorRuntime = r")(o)}},861:(e,t,n)=>{"use strict";function o(e,t,n,o,r,a,s){try{var i=e[a](s),u=i.value}catch(e){return void n(e)}i.done?t(u):Promise.resolve(u).then(o,r)}function r(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function i(e){o(s,r,a,i,u,"next",e)}function u(e){o(s,r,a,i,u,"throw",e)}i(void 0)}))}}n.d(t,{Z:()=>r})},942:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var o=n(142);function r(e,t,n){return(t=(0,o.Z)(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},152:(e,t,n)=>{"use strict";function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,a,s,i=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=a.call(n)).done)&&(i.push(o.value),i.length!==t);u=!0);}catch(e){c=!0,r=e}finally{try{if(!u&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw r}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n.d(t,{Z:()=>r})},142:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var o=n(2);function r(e){var t=function(e,t){if("object"!==(0,o.Z)(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==(0,o.Z)(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===(0,o.Z)(t)?t:String(t)}},2:(e,t,n)=>{"use strict";function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}n.d(t,{Z:()=>o})},164:(e,t,n)=>{"use strict";n.a(e,(async(e,o)=>{try{n.d(t,{$I:()=>l,e9:()=>d,x$:()=>c});var r=n(942),a=n(152),s=n(861),i=n(687),u=n(550);await p();var c=await chrome.storage.sync.get();function l(e,t){return h.apply(this,arguments)}function h(){return(h=(0,s.Z)(i.mark((function e(t,n){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c[t]=n,e.next=3,chrome.storage.sync.set((0,r.Z)({},t,n));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(){return f.apply(this,arguments)}function f(){return(f=(0,s.Z)(i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(c.userQuotaResetTime<Date.now())){e.next=5;break}return e.next=3,l("userQuotaRemainingToday",200);case 3:return e.next=5,l("userQuotaResetTime",new Date((new Date).setHours(24,0,0,0)).getTime());case 5:return e.abrupt("return",c.userQuotaRemainingToday);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(){return y.apply(this,arguments)}function y(){return(y=(0,s.Z)(i.mark((function e(){var t,n,o,s,c,l,h,d,f,p;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,chrome.storage.sync.get();case 2:t=e.sent,n=0,o=Object.entries(u._);case 4:if(!(n<o.length)){e.next=12;break}if(s=(0,a.Z)(o[n],2),c=s[0],l=s[1],void 0!==t[c]){e.next=9;break}return e.next=9,chrome.storage.sync.set((0,r.Z)({},c,l));case 9:n++,e.next=4;break;case 12:h=0,d=Object.entries(t);case 13:if(!(h<d.length)){e.next=21;break}if(f=(0,a.Z)(d[h],2),p=f[0],f[1],void 0!==u._[p]){e.next=18;break}return e.next=18,chrome.storage.sync.remove(p);case 18:h++,e.next=13;break;case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}chrome.storage.onChanged.addListener(function(){var e=(0,s.Z)(i.mark((function e(t,n){var o,r,s,u,l;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("sync"===n){e.next=2;break}return e.abrupt("return");case 2:for(o=0,r=Object.entries(t);o<r.length;o++)s=(0,a.Z)(r[o],2),u=s[0],l=s[1],c[u]=l.newValue;case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),o()}catch(v){o(v)}}),1)},550:(e,t,n)=>{"use strict";n.d(t,{P:()=>r,_:()=>o});var o={useCustomApiKeyOption:!1,customYoutubeApiKey:null,databaseSharingEnabledOption:!0,shuffleOpenInNewTabOption:!0,shuffleReUseNewTabOption:!0,shuffleIgnoreShortsOption:1,shuffleOpenAsPlaylistOption:!0,shuffleNumVideosInPlaylist:10,shuffleTabId:null,channelSettings:{},currentChannelId:null,currentChannelName:null,numShuffledVideosTotal:0,userQuotaRemainingToday:200,userQuotaResetTime:new Date((new Date).setHours(24,0,0,0)).getTime(),nextAPIKeysCheckTime:new Date((new Date).setHours(168,0,0,0)).getTime(),lastViewedChangelogVersion:"0",wasLastRickRolledInYear:"1970",previousVersion:null,reviewMessageShown:!1,donationMessageShown:!1},r=["The extension adds a 'Shuffle' button to all channel, video and shorts pages on YouTube. This button has the same behaviour as shuffling from the popup!","If you are the first person to shuffle from a channel, the video ID's of that channel are saved both locally and in a remote database for other users to use!","The extension does not collect any personal information, it only stores video ID's of channels you shuffle from, without linking them back to you!","You only have a certain number of requests to the YouTube API per day. You can remove this limit by providing your own API key in the popup!","The extension popup shows you how many videos you have shuffled so far!","The list of videos uploaded on a channel is updated regularly, so don't worry if you don't immediately see a recently uploaded video when shuffling!","All video ID's are stored locally in your browser's storage, to make shuffling from a channel even faster the next time you visit it!","The 'Shuffle' button will display a progress percentage if the extension has to fetch data from the YouTube API!","Whenever an error is encountered, an alert will open with more detailed information on what caused it, and how you may resolve it. If you still need assistence, please open an issue on GitHub and include the channel ID!","Use the 'Open in new tab' option to open each shuffled video in its own tab!","Use the 'Reuse new tab' option to only open a new tab on the first shuffle, and open subsequent shuffled videos in that tab, no matter from which tab you start the shuffle!","Use the 'Open in playlist' option to open shuffled videos in the uploads playlist of the channel! You can customize how many videos are added to the playlist!","You can choose to ignore, include, or only shuffle from shorts uploaded on a channel!","Use the 'Use custom API key' option to provide your own YouTube API key, which will be used instead of the extension's keys. This removes the API quota limit and allows you to opt out of sharing video IDs with other users!","The extension popup allows you to customize the shuffling experience for the most recently visited channel at any time!","You can choose from a number of filters to choose what videos are considered when shuffling from a specific channel!","The 'Shuffle' button in the popup always shuffles from your most recently visited channel!","You can choose to only shuffle from the most recent X percentage of videos uploaded on the channel by using the '...the most recent x% of videos' shuffle filter!","You can choose to only shuffle from videos uploaded after a specific date by using the '...videos uploaded after date' shuffle filter!","You can choose to only shuffle from videos uploaded after a specific other video by using the '...videos after video with ID' shuffle filter!","If you provide a custom YouTube API key, it will be validated first to make sure you can use it with the extension!","If you provide a custom YouTube API key, you are able to opt out of sharing video ID's with the extension's database. In this case, video ID's are only stored locally!","If you provide a custom YouTube API key, it is never shared with the extension's database, and only stored locally!","The popup will highlight the 'Changelog' button whenever a new version of the extension has been installed!","Want to stay up-to-date on the newest features and improvements? Check out the changelog using the button in the popup!","Do you have an idea on how this extension could be improved? Open an issue on GitHub and let me know!","Use the handy links located at the bottom of the popup and other pages to immediately view the extension on different stores!","If you are enjoying this extension, please consider leaving a review to help others find it!","If you want to stay up-to-date with the extension's development, consider starring the GitHub repository!","This extension is a hobby project - you can support it by sponsoring me on GitHub or donating on Ko-Fi!","The extension's source code is available on GitHub: https://github.com/NikkelM/Random-YouTube-Video"]},264:(e,t,n)=>{"use strict";n.d(t,{X:()=>l,u:()=>s});var o=n(861),r=n(687),a=n(550);function s(e){return i.apply(this,arguments)}function i(){return(i=(0,o.Z)(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(t.shufflingHintP);case 2:n=e.sent,t.nextHintButton.addEventListener("click",(0,o.Z)(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(t.shufflingHintP,n);case 2:n=e.sent;case 3:case"end":return e.stop()}}),e)}))));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function u(e){return c.apply(this,arguments)}function c(){return c=(0,o.Z)(r.mark((function e(t){var n,o,s=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=n=s.length>1&&void 0!==s[1]?s[1]:null;o===n;)o=Math.floor(Math.random()*a.P.length);return t.innerText=a.P[o],e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}function l(e){return h.apply(this,arguments)}function h(){return(h=(0,o.Z)(r.mark((function e(t){var n,o,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!0,e.next=3,chrome.tabs.query({});case 3:o=e.sent,a=0;case 5:if(!(a<=o.length-1)){e.next=13;break}if(o[a].url!==t){e.next=10;break}return n=!1,chrome.tabs.update(o[a].id,{active:!0}),e.abrupt("break",13);case 10:a++,e.next=5;break;case 13:return e.abrupt("return",n);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},551:(e,t,n)=>{"use strict";n.a(e,(async(e,t)=>{try{var o=n(861),r=n(687),a=n(385),s=n(164),i=n(264),u=n(524),c=e([s,u]);[s,u]=c.then?(await c)():c;try{await chrome.runtime.sendMessage({command:"connectionTest"})}catch(g){console.log("The background worker was stopped and had to be restarted."),await(0,a.gw)(10)}var l=chrome.runtime.connect({name:"shufflingPage"}),h={randomYoutubeVideo:document.getElementById("randomYoutubeVideo"),fetchPercentageNoticeShufflingPage:document.getElementById("fetchPercentageNoticeShufflingPage"),shuffleErrorText:document.getElementById("shuffleErrorText"),shufflingInProgressElements:document.getElementById("shufflingInProgressElements"),shufflingFromChannelHeading:document.getElementById("shufflingFromChannelHeading"),shufflingHintP:document.getElementById("shufflingHintP"),nextHintButton:document.getElementById("nextHintButton"),viewChangelogButton:document.getElementById("viewChangelogButton")};function d(e){return f.apply(this,arguments)}function f(){return f=(0,o.Z)(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.viewChangelogButton.addEventListener("click",(0,o.Z)(r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.$I)("lastViewedChangelogVersion",chrome.runtime.getManifest().version);case 2:return t=chrome.runtime.getURL("html/changelog.html"),e.next=5,(0,i.X)(t);case 5:e.sent&&window.open(t,"_blank");case 7:case"end":return e.stop()}}),e)}))));case 1:case"end":return e.stop()}}),e)}))),f.apply(this,arguments)}function p(){return y.apply(this,arguments)}function y(){return(y=(0,o.Z)(r.mark((function e(){var t,n,o,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,h.shufflingFromChannelHeading.innerText=s.x$.currentChannelName,t=h.fetchPercentageNoticeShufflingPage,(0,a.of)(t,"Applying filters...",4e3,(function(){return"Please wait..."===t.innerText||"Fetching: 100%"===t.innerText})),(0,a.of)(t,"Should be done soon...",8e3,(function(){return"Applying filters..."===t.innerText||"Fetching: 100%"===t.innerText})),"1"!=s.x$.shuffleIgnoreShortsOption?((0,a.of)(t,"Sorting shorts...",12e3,(function(){return"Should be done soon..."===t.innerText||"Fetching: 100%"===t.innerText})),"2"==s.x$.shuffleIgnoreShortsOption?(0,a.of)(t,"Lots of shorts...",2e4,(function(){return"Sorting shorts..."===t.innerText||"Fetching: 100%"===t.innerText})):"0"==s.x$.shuffleIgnoreShortsOption&&(0,a.of)(t,"Not many shorts...",2e4,(function(){return"Sorting shorts..."===t.innerText||"Fetching: 100%"===t.innerText})),(0,a.of)(t,"Still sorting...",35e3,(function(){return"Lots of shorts..."===t.innerText||"Not many shorts..."===t.innerText||"Fetching: 100%"===t.innerText}))):(0,a.of)(t,"Still shuffling...",2e4,(function(){return"Should be done soon..."===t.innerText||"Fetching: 100%"===t.innerText})),e.next=8,(0,u.i)(s.x$.currentChannelId,!0,t);case 8:chrome.tabs.query({url:chrome.runtime.getURL("html/shufflingPage.html")},(function(e){e.length>0&&chrome.tabs.update(e[0].id,{active:!0})})),l.postMessage({command:"shuffleComplete"}),e.next=33;break;case 12:e.prev=12,e.t0=e.catch(0),console.error(e.t0.stack),console.error(e.t0.message),o="",e.t1=e.t0.name,e.next="RandomYoutubeVideoError"===e.t1?20:"YoutubeAPIError"===e.t1?22:24;break;case 20:return o="Error ".concat(e.t0.code),e.abrupt("break",25);case 22:return o="API Error ".concat(e.t0.code),e.abrupt("break",25);case 24:o="Unknown Error";case 25:return i="".concat(null!==(n=e.t0.message)&&void 0!==n?n:"").concat(e.t0.reason?"\n"+e.t0.reason:"").concat(e.t0.solveHint?"\n"+e.t0.solveHint:"").concat(!1!==e.t0.showTrace?"\n\n"+e.t0.stack:""),h.fetchPercentageNoticeShufflingPage.innerText=o,h.shuffleErrorText.innerText=i,h.shuffleErrorText.classList.remove("hidden"),h.shufflingInProgressElements.classList.add("hidden"),h.randomYoutubeVideo.classList.remove("hidden"),l.postMessage({command:"shuffleComplete"}),e.abrupt("return");case 33:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}function v(){return m.apply(this,arguments)}function m(){return(m=(0,o.Z)(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.gw)(1e3);case 2:h.randomYoutubeVideo.classList.remove("hidden");case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}await d(h),p(),s.x$.lastViewedChangelogVersion!==chrome.runtime.getManifest().version&&h.viewChangelogButton.classList.add("highlight-green"),await(0,i.u)(h),v(),t()}catch(b){t(b)}}),1)},524:(e,t,n)=>{"use strict";n.a(e,(async(e,o)=>{try{n.d(t,{i:()=>l});var r=n(942),a=n(861),s=n(687),i=n(385),u=n(164),c=e([u]);function l(e,t,n){return h.apply(this,arguments)}function h(){return(h=(0,a.Z)(s.mark((function e(t,n,o){var r,a,c,l,h,f,y,v,m,b,x,k,T,I,P,S,O,A,V;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,chrome.runtime.sendMessage({command:"connectionTest"});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.log("The service worker was stopped and had to be restarted.");case 8:return e.prev=8,h=setInterval((function(){chrome.runtime.sendMessage({command:"connectionTest"})}),25e3),e.next=12,(0,u.e9)();case 12:if(f=e.sent,y=!1,v=u.x$.databaseSharingEnabledOption,m=t?t.replace("UC","UU"):null){e.next=18;break}throw new i.Zi({code:"RYV-1",message:"No channel-ID found.",solveHint:"Please reload the page and try again. Please inform the developer if this keeps happening.",showTrace:!1,canSavePlaylist:!1});case 18:return console.log("Shuffling from playlist/channel: ".concat(m)),e.next=21,F(m);case 21:if(b=e.sent,!(0,i.xb)(b)){e.next=53;break}if(console.log("Uploads playlist for this channel does not exist locally.".concat(v?" Trying to get it from the database...":"")),!v){e.next=30;break}return e.next=27,d(m);case 27:e.t1=e.sent,e.next=31;break;case 30:e.t1={};case 31:if(b=e.t1,!(0,i.xb)(b)){e.next=42;break}return v?console.log("Uploads playlist for this channel does not exist in the database. Fetching it from the YouTube API..."):console.log("Fetching the uploads playlist for this channel from the YouTube API..."),e.next=36,g(m,null,f,o);case 36:k=e.sent,b=k.playlistInfo,f=k.userQuotaRemainingToday,y=!0,e.next=50;break;case 42:if(!(v&&(null!==(x=b.lastUpdatedDBAt)&&void 0!==x?x:new Date(0).toISOString())<(0,i.TR)(new Date,-48).toISOString())){e.next=50;break}return console.log("Uploads playlist for this channel may be outdated in the database. Updating from the YouTube API..."),e.next=46,w(b,m,null,f,o);case 46:T=e.sent,b=T.playlistInfo,f=T.userQuotaRemainingToday,y=!0;case 50:console.log("Uploads playlist for this channel successfully retrieved."),e.next=81;break;case 53:if(!(v&&(null!==(r=b.lastFetchedFromDB)&&void 0!==r?r:new Date(0).toISOString())<(0,i.TR)(new Date,-48).toISOString()||!v&&(null!==(a=b.lastAccessedLocally)&&void 0!==a?a:new Date(0).toISOString())<(0,i.TR)(new Date,-48).toISOString())){e.next=81;break}if(console.log("Local uploads playlist for this channel may be outdated.".concat(v?" Updating from the database...":"")),!v){e.next=61;break}return e.next=58,d(m,b);case 58:e.t2=e.sent,e.next=62;break;case 61:e.t2={};case 62:if(b=e.t2,!(0,i.xb)(b)){e.next=73;break}return console.log("".concat(v?"Uploads playlist for this channel does not exist in the database. ":"Fetching it from the YouTube API...")),e.next=67,g(m,null,f,o);case 67:P=e.sent,b=P.playlistInfo,f=P.userQuotaRemainingToday,y=!0,e.next=81;break;case 73:if(!((null!==(I=b.lastUpdatedDBAt)&&void 0!==I?I:new Date(0).toISOString())<(0,i.TR)(new Date,-48).toISOString())){e.next=81;break}return console.log("Uploads playlist for this channel may be outdated in the database. Updating from the YouTube API..."),e.next=77,w(b,m,null,f,o);case 77:S=e.sent,b=S.playlistInfo,f=S.userQuotaRemainingToday,y=!0;case 81:return e.next=83,(0,u.$I)("userQuotaRemainingToday",Math.max(0,f));case 83:return M(b),b.videos.unknownType=Object.assign({},null!==(c=b.videos.unknownType)&&void 0!==c?c:{},null!==(l=b.newVideos)&&void 0!==l?l:{}),e.next=87,R(b,t,y);case 87:return V=e.sent,O=V.chosenVideos,b=V.playlistInfo,y=V.shouldUpdateDatabase,A=V.encounteredDeletedVideos,e.next=94,p(b,m,y,v,A);case 94:return b=e.sent,e.next=97,U(m,b);case 97:return e.next=99,(0,u.$I)("numShuffledVideosTotal",u.x$.numShuffledVideosTotal+1);case 99:return e.next=101,Z(O,n);case 101:e.next=114;break;case 103:return e.prev=103,e.t3=e.catch(8),e.next=107,(0,u.$I)("userQuotaRemainingToday",Math.max(0,u.x$.userQuotaRemainingToday-1));case 107:if(!(e.t3 instanceof i.Zi&&1==e.t3.canSavePlaylist)){e.next=113;break}return e.next=110,p(b,m,y,v,A);case 110:return b=e.sent,e.next=113,U(m,b);case 113:throw e.t3;case 114:return e.prev=114,clearInterval(h),e.finish(114);case 117:case"end":return e.stop()}}),e,null,[[0,5],[8,103,114,117]])})))).apply(this,arguments)}function d(e){return f.apply(this,arguments)}function f(){return f=(0,a.Z)(s.mark((function e(t){var n,o,r,a,i,u,c,l,h,d,f,p,y,v,m,g=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=g.length>1&&void 0!==g[1]?g[1]:null,o={command:"getPlaylistFromDB",data:t},e.next=4,chrome.runtime.sendMessage(o);case 4:if(!((r=e.sent)&&r.videos&&Array.isArray(r.videos))){e.next=10;break}return console.log("The playlist was found in the database, but it is in an old format (before v1.0.0). Removing..."),e.next=9,chrome.runtime.sendMessage({command:"updateDBPlaylistToV1.0.0",data:{key:t}});case 9:return e.abrupt("return",{});case 10:if(r&&r.videos&&"string"==typeof r.videos&&r.videos[Object.keys(r.videos)[0]].length>10)for(a in console.log("The playlist was found in the database, but it is in an old format (before v1.3.0). Updating format..."),r.videos)r.videos[a]=r.videos[a].substring(0,10);if(r&&r.videos){e.next=13;break}return e.abrupt("return",{});case 13:if(r.lastFetchedFromDB=(new Date).toISOString(),i=JSON.parse(JSON.stringify(r.videos)),n)for(l=B(n),h=new Set(Object.keys(l)),d=new Set(Object.keys(r.videos)),f=Object.keys(r.videos).filter((function(e){return!h.has(e)})),r.videos={},r.videos.unknownType=Object.assign({},n.videos.unknownType,Object.fromEntries(f.map((function(e){return[e,i[e]]})))),r.videos.knownVideos=null!==(u=n.videos.knownVideos)&&void 0!==u?u:{},r.videos.knownShorts=null!==(c=n.videos.knownShorts)&&void 0!==c?c:{},p=0,y=["knownVideos","knownShorts","unknownType"];p<y.length;p++)for(m in v=y[p],n.videos[v])d.has(m)||delete r.videos[v][m];else r.videos={},r.videos.unknownType=i,r.videos.knownVideos={},r.videos.knownShorts={};return e.abrupt("return",r);case 17:case"end":return e.stop()}}),e)}))),f.apply(this,arguments)}function p(e,t,n,o,r){return y.apply(this,arguments)}function y(){return(y=(0,a.Z)(s.mark((function e(t,n,o,r,a){var u,c;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o||!r){e.next=8;break}return console.log("Updating the database with the new playlist information..."),t.lastUpdatedDBAt=(new Date).toISOString(),u={},a?(console.log("Some videos need to be deleted from the database. All current videos will be uploaded to the database..."),u=B(t)):(console.log("Uploading new video IDs to the database..."),u=(0,i.xA)(null!==(c=t.newVideos)&&void 0!==c?c:{})>0?t.newVideos:B(t)),e.next=7,v(t,u,n,a);case 7:t.lastFetchedFromDB=(new Date).toISOString();case 8:return e.abrupt("return",t);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e,t,n,o){return m.apply(this,arguments)}function m(){return(m=(0,a.Z)(s.mark((function e(t,n,o,r){var a,u,c,l;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(24===(c={lastUpdatedDBAt:null!==(a=t.lastUpdatedDBAt)&&void 0!==a?a:(new Date).toISOString(),lastVideoPublishedAt:null!==(u=t.lastVideoPublishedAt)&&void 0!==u?u:new Date(0).toISOString().slice(0,19)+"Z",videos:n}).lastUpdatedDBAt.length){e.next=4;break}return alert("Random YouTube Video:\nPlease send this information to the developer:\n\nlastUpdatedDBAt has the wrong format (got ".concat(c.lastVideoPublishedAt,").\nChannelId: ").concat(o,".")),e.abrupt("return");case 4:if(20===c.lastVideoPublishedAt.length){e.next=7;break}return alert("Random YouTube Video:\nPlease send this information to the developer:\n\nlastVideoPublishedAt has the wrong format (got ".concat(c.lastVideoPublishedAt,").\nChannelId: ").concat(o,".")),e.abrupt("return");case 7:if(!((0,i.xA)(c.videos)<1)){e.next=10;break}return alert("Random YouTube Video:\nPlease send this information to the developer:\n\nNo videos object was found.\nChannelId: ".concat(o,".")),e.abrupt("return");case 10:return l={command:r?"overwritePlaylistInfoInDB":"updatePlaylistInfoInDB",data:{key:o,val:c}},e.next=13,chrome.runtime.sendMessage(l);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e,t,n,o){return b.apply(this,arguments)}function b(){return(b=(0,a.Z)(s.mark((function e(t,n,o,r){var a,u,c,l,h,d,f,p,y,v,m,g,b,w;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A(n);case 2:if(a=e.sent,u=a.APIKey,c=a.isCustomKey,l=a.keyIndex,h=l,c||!(o<=0)){e.next=9;break}throw new i.Zi({code:"RYV-4A",message:"You have exceeded your daily quota allocation for the YouTube API.",solveHint:"You can try again tomorrow or provide a custom API key.",showTrace:!1,canSavePlaylist:!1});case 9:return(d={}).videos={},d.videos.unknownType={},d.videos.knownVideos={},d.videos.knownShorts={},f="",e.next=17,k(t,f,u,c,l,h,o);case 17:if(y=e.sent,p=y.apiResponse,u=y.APIKey,c=y.isCustomKey,l=y.keyIndex,o=y.userQuotaRemainingToday,!((v=p.pageInfo.totalResults)/50>=o+50)||c){e.next=26;break}throw new i.Zi({code:"RYV-4B",message:"The channel you are shuffling from has too many uploads (".concat(v,") for the amount of API requests you can make. To protect the userbase, each user has a limited amount of requests they can make per day."),solveHint:"To shuffle from channels with more uploads, please use a custom API key.",showTrace:!1,canSavePlaylist:!1});case 26:v>=19999&&window.alert("NOTICE: The channel you are shuffling from has a lot of uploads (20,000+). The YouTube API only allows fetching the most recent 20,000 videos, which means that older uploads will not be shuffled from. This limitation is in place no matter if you use a custom API key or not.\n\nThe extension will now fetch all videos it can get from the API."),m=p.items.length,v>50&&(g=Math.round(m/v*100),C(r," Fetching: ".concat(g,"%"),"".concat(g,"%"))),d.videos.unknownType=Object.fromEntries(p.items.map((function(e){return[e.contentDetails.videoId,e.contentDetails.videoPublishedAt.substring(0,10)]}))),d.lastVideoPublishedAt=p.items[0].contentDetails.videoPublishedAt,f=p.nextPageToken?p.nextPageToken:null;case 32:if(null===f){e.next=48;break}return e.next=35,k(t,f,u,c,l,h,o);case 35:b=e.sent,p=b.apiResponse,u=b.APIKey,c=b.isCustomKey,l=b.keyIndex,o=b.userQuotaRemainingToday,m+=p.items.length,w=Math.round(m/v*100),C(r," Fetching: ".concat(w,"%"),"".concat(w,"%")),d.videos.unknownType=Object.assign(d.videos.unknownType,Object.fromEntries(p.items.map((function(e){return[e.contentDetails.videoId,e.contentDetails.videoPublishedAt.substring(0,10)]})))),f=p.nextPageToken?p.nextPageToken:null,e.next=32;break;case 48:return d.lastFetchedFromDB=(new Date).toISOString(),e.abrupt("return",{playlistInfo:d,userQuotaRemainingToday:o});case 50:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e,t,n,o,r){return x.apply(this,arguments)}function x(){return(x=(0,a.Z)(s.mark((function e(t,n,o,r,a){var u,c,l,h,d,f,p,y,v,m,b,w,x,T,I,P,S,O;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A(o);case 2:if(u=e.sent,c=u.APIKey,l=u.isCustomKey,h=u.keyIndex,d=h,l||!(r<=0)){e.next=9;break}throw new i.Zi({code:"RYV-4A",message:"You have exceeded your daily quota allocation for the YouTube API.",solveHint:"You can try again tomorrow or provide a custom API key.",showTrace:!1,canSavePlaylist:!1});case 9:return f=t.lastVideoPublishedAt,e.next=12,k(n,"",c,l,h,d,r);case 12:if(y=e.sent,p=y.apiResponse,c=y.APIKey,l=y.isCustomKey,h=y.keyIndex,r=y.userQuotaRemainingToday,v=p.pageInfo.totalResults,m=(0,i.xA)(B(t)),!((b=v>19999?1e3:Math.max(v-m,0))/50>=r+50)||l){e.next=23;break}throw new i.Zi({code:"RYV-4B",message:"The channel you are shuffling from has too many new uploads (".concat(b,") for the amount of API requests you can make. To protect the userbase, each user has a limited amount of requests they can make per day."),solveHint:"To shuffle from channels with more uploads, please use a custom API key.",showTrace:!1,canSavePlaylist:!1});case 23:if(w=p.items.length,b>50&&(x=Math.min(Math.round(w/b*100),100),C(a," Fetching: ".concat(x,"%"),"".concat(x,"%"))),!(f<p.items[0].contentDetails.videoPublishedAt)){e.next=30;break}console.log("At least one video has been published since the last check, updating video ID's..."),t.lastVideoPublishedAt=p.items[0].contentDetails.videoPublishedAt,e.next=37;break;case 30:if(console.log("No new videos have been published since the last check."),!(v>m)){e.next=36;break}return console.log("There are less videos saved in the database than are uploaded on the channel (".concat(m,"/").concat(v,"), so some videos are missing. Refetching all videos...")),e.next=35,g(n,h,r,a);case 35:return e.abrupt("return",e.sent);case 36:return e.abrupt("return",{playlistInfo:t,userQuotaRemainingToday:r});case 37:T=0,I={};case 39:if(!(f<p.items[T].contentDetails.videoPublishedAt)){e.next=61;break}if(I[p.items[T].contentDetails.videoId]=p.items[T].contentDetails.videoPublishedAt.substring(0,10),!(++T>=p.items.length)){e.next=59;break}if(!p.nextPageToken){e.next=58;break}return e.next=46,k(n,p.nextPageToken,c,l,h,d,r);case 46:P=e.sent,p=P.apiResponse,c=P.APIKey,l=P.isCustomKey,h=P.keyIndex,r=P.userQuotaRemainingToday,w+=p.items.length,S=Math.min(Math.round(w/b*100),100),C(a," Fetching: ".concat(S,"%"),"".concat(S,"%")),T=0,e.next=59;break;case 58:return e.abrupt("break",61);case 59:e.next=39;break;case 61:if(console.log("Found ".concat(Object.keys(I).length," new video(s).")),t.newVideos=I,O=m+(0,i.xA)(t.newVideos),!(v>O)){e.next=69;break}return console.log("There are less videos saved in the database than are uploaded on the channel (".concat(O,"/").concat(v,"), so some videos are missing. Refetching all videos...")),e.next=68,g(n,h,r,a);case 68:return e.abrupt("return",e.sent);case 69:return e.abrupt("return",{playlistInfo:t,userQuotaRemainingToday:r});case 70:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e,t,n,o,r,a,s){return T.apply(this,arguments)}function T(){return(T=(0,a.Z)(s.mark((function e(t,n,o,r,a,c,l){var h,d,f;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:h=l;case 1:return e.prev=2,console.log("Getting snippet from YouTube API..."),e.next=6,fetch("https://youtube.googleapis.com/youtube/v3/playlistItems?part=contentDetails&maxResults=50&pageToken=".concat(n,"&playlistId=").concat(t,"&key=").concat(o)).then((function(e){return e.json()})).then((function(e){return d=e}));case 6:if(!d.error){e.next=8;break}throw new i.VU(d.error.code,d.error.message,d.error.errors[0].reason,"",!1,!1);case 8:if(!(--l<=-50)){e.next=11;break}throw new i.Zi({code:"RYV-4B",message:"The channel you are shuffling from has too many uploads for the amount of API requests you can make. To protect the userbase, each user has a limited amount of requests they can make per day.",solveHint:"To shuffle from channels with more uploads, please use a custom API key.",showTrace:!1,canSavePlaylist:!1});case 11:return e.abrupt("break",43);case 14:return e.prev=14,e.t0=e.catch(2),e.next=18,(0,u.$I)("userQuotaRemainingToday",Math.max(0,Math.min(200,l+1)));case 18:if(!(e.t0 instanceof i.VU&&403===e.t0.code&&"quotaExceeded"===e.t0.reason)){e.next=36;break}if(r){e.next=33;break}return console.log("Quota for this key was exceeded, refreshing API keys and trying again..."),e.next=23,(0,u.$I)("nextAPIKeysCheckTime",Date.now()-100);case 23:return e.next=25,A(a+1);case 25:if(f=e.sent,o=f.APIKey,r=f.isCustomKey,(a=f.keyIndex)!==c){e.next=31;break}throw new i.Zi({code:"RYV-2",message:"All API keys have exceeded the allocated quota.",solveHint:"Please *immediately* inform the developer. You can try again tomorrow or provide a custom API key to immediately resolve this problem.",showTrace:!1,canSavePlaylist:!1});case 31:e.next=34;break;case 33:throw new i.Zi({code:"RYV-5",message:"Your custom API key has reached its daily quota allocation.",solveHint:"This can easily happen if the channels you are shuffling from have a lot of uploads, or if you are using the API key for something else as well. You need to wait until the quota is reset or use a different API key.",showTrace:!1,canSavePlaylist:!1});case 34:e.next=41;break;case 36:if(!(e.t0 instanceof i.VU&&404===e.t0.code&&"playlistNotFound"===e.t0.reason)){e.next=40;break}throw new i.Zi({code:"RYV-6A",message:"This channel has not uploaded any videos.",showTrace:!1,canSavePlaylist:!1});case 40:throw e.t0;case 41:e.next=1;break;case 43:return l=r?h:l,e.abrupt("return",{apiResponse:d,APIKey:o,isCustomKey:r,keyIndex:a,userQuotaRemainingToday:l});case 45:case"end":return e.stop()}}),e,null,[[2,14]])})))).apply(this,arguments)}function I(e,t){return P.apply(this,arguments)}function P(){return(P=(0,a.Z)(s.mark((function e(t,n){var o,r,a,i;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=Math.floor((new Date-new Date(n))/864e5),r=o<=2?0:o<=7?1:o<=60?.5:.2,!(Math.random()>r)){e.next=4;break}return e.abrupt("return",!0);case 4:return e.prev=4,e.next=7,fetch("https://www.youtube.com/oembed?url=http://www.youtube.com/watch?v=".concat(t,"&format=json"),{method:"HEAD"});case 7:if(401!==(i=e.sent).status){e.next=15;break}return e.next=11,fetch("https://img.youtube.com/vi/".concat(t,"/0.jpg"),{method:"HEAD"});case 11:200!==e.sent.status?(console.log("Video doesn't exist: ".concat(t)),a=!1):a=!0,e.next=16;break;case 15:200!==i.status?(console.log("Video doesn't exist: ".concat(t)),a=!1):a=!0;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(4),console.log("An error was encountered while checking for video existence, so it is assumed the video does not exist: ".concat(t)),a=!1;case 22:return e.abrupt("return",a);case 23:case"end":return e.stop()}}),e,null,[[4,18]])})))).apply(this,arguments)}function S(e){return O.apply(this,arguments)}function O(){return(O=(0,a.Z)(s.mark((function e(t){var n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://www.youtube.com/oembed?url=http://www.youtube.com/shorts/".concat(t,"&format=json"),{method:"GET"}).then((function(e){return e.json()})).then((function(e){n=!!e.thumbnail_url.endsWith("hq2.jpg")}));case 3:e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(0),e.next=9,fetch("https://www.youtube.com/shorts/".concat(t)).then((function(e){n=!e.redirected}));case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}}),e,null,[[0,5]])})))).apply(this,arguments)}function A(){return V.apply(this,arguments)}function V(){return V=(0,a.Z)(s.mark((function e(){var t,n,o,r,a,u=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={command:"getAPIKey",data:{useAPIKeyAtIndex:u.length>0&&void 0!==u[0]?u[0]:null}},e.next=4,chrome.runtime.sendMessage(t);case 4:if(n=e.sent,o=n.APIKey,r=n.isCustomKey,a=n.keyIndex,o){e.next=10;break}throw new i.Zi({code:"RYV-3",message:"There are no API keys available in the database. It may be that they were removed for security reasons.",solveHint:"Please check back later to see if this has been resolved, otherwise contact the developer. You can always use the extension by providing your custom API key via the popup, which is never uploaded to the extension's database.",showTrace:!1,canSavePlaylist:!1});case 10:return e.abrupt("return",{APIKey:o,isCustomKey:r,keyIndex:a});case 11:case"end":return e.stop()}}),e)}))),V.apply(this,arguments)}function R(e,t,n){return D.apply(this,arguments)}function D(){return(D=(0,a.Z)(s.mark((function e(t,n,o){var r,a,c,l,h,d,f,p,y,v,m,g,b,w,x,k,T,P,O,A,V;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:p=null!==(r=null===(a=u.x$.channelSettings[n])||void 0===a?void 0:a.activeOption)&&void 0!==r?r:"allVideosOption",e.t0=p,e.next="allVideosOption"===e.t0?4:"dateOption"===e.t0?6:"videoIdOption"===e.t0?8:"percentageOption"===e.t0?10:12;break;case 4:return y=null,e.abrupt("break",12);case 6:return y=null===(c=u.x$.channelSettings[n])||void 0===c?void 0:c.dateValue,e.abrupt("break",12);case 8:return y=null===(l=u.x$.channelSettings[n])||void 0===l?void 0:l.videoIdValue,e.abrupt("break",12);case 10:return y=null!==(h=null===(d=u.x$.channelSettings[n])||void 0===d?void 0:d.percentageValue)&&void 0!==h?h:100,e.abrupt("break",12);case 12:if(void 0!==y){e.next=14;break}throw new i.Zi({code:"RYV-7",message:"You have set an option to filter the videos that are shuffled (".concat(p,"), but no value for the option is set."),solveHint:"Please set a value for the active shuffle filter option in the popup, e.g. a valid date or video ID.",showTrace:!1,canSavePlaylist:!0});case 14:v=Object.assign({},t.videos.unknownType,null!==(f=t.newVideos)&&void 0!==f?f:{}),m=t.videos.knownVideos,g=t.videos.knownShorts,b="1"==u.x$.shuffleIgnoreShortsOption?Object.assign({},v,m,g):"2"==u.x$.shuffleIgnoreShortsOption?Object.assign({},v,m):Object.assign({},v,g),w=Object.keys(b).sort((function(e,t){return new Date(b[t])-new Date(b[e])})),x=j(b,w,p,y),k=[],P=!1,O=u.x$.shuffleOpenAsPlaylistOption?u.x$.shuffleNumVideosInPlaylist:1,console.log("Choosing ".concat(O," random video(s).")),A=0;case 25:if(!(A<O)){e.next=96;break}if(0!==x.length){e.next=29;break}return console.log("No more videos to choose from (".concat(O-A," videos too few uploaded on channel).")),e.abrupt("break",96);case 29:return T=x[Math.floor(Math.random()*x.length)],e.next=32,I(T,b[T]);case 32:if(e.sent){e.next=49;break}P=!0,o=!0;case 35:if(delete t.videos[Y(T,t)][T],x.splice(x.indexOf(T),1),T=x[Math.floor(Math.random()*x.length)],console.log("The chosen video does not exist anymore, so it will be removed from the database. A new random video has been chosen: ".concat(T)),void 0!==T){e.next=46;break}if(0!==k.length){e.next=44;break}throw new i.Zi({code:"RYV-6B",message:"All previously uploaded videos on this channel were deleted (the channel does not have any uploads) or you are ignoring/only shuffling from shorts and the channel only has/has no shorts.",solveHint:"If you are ignoring shorts, disable the option in the popup to shuffle from this channel.",showTrace:!1,canSavePlaylist:!0});case 44:return console.log("No more videos to choose from (".concat(O-A," videos too few uploaded on channel).")),e.abrupt("break",96);case 46:return e.next=48,I(T,b[T]);case 48:if(!e.sent){e.next=35;break}case 49:if("1"==u.x$.shuffleIgnoreShortsOption){e.next=91;break}if(void 0===t.videos.unknownType[T]){e.next=87;break}return e.next=53,S(T);case 53:if((V=e.sent)||"2"!=u.x$.shuffleIgnoreShortsOption){e.next=61;break}t.videos.knownVideos[T]=t.videos.unknownType[T],delete t.videos.unknownType[T],k.push(T),x.splice(x.indexOf(T),1),e.next=85;break;case 61:if(!V||"2"!=u.x$.shuffleIgnoreShortsOption){e.next=69;break}console.log("A chosen video was a short, but shorts are ignored. Choosing a new random video."),t.videos.knownShorts[T]=t.videos.unknownType[T],delete t.videos.unknownType[T],x.splice(x.indexOf(T),1),A--,e.next=85;break;case 69:if(!V||"0"!=u.x$.shuffleIgnoreShortsOption){e.next=76;break}t.videos.knownShorts[T]=t.videos.unknownType[T],delete t.videos.unknownType[T],k.push(T),x.splice(x.indexOf(T),1),e.next=85;break;case 76:if(V||"0"!=u.x$.shuffleIgnoreShortsOption){e.next=84;break}console.log("A chosen video was not a short, but only shorts should be shuffled. Choosing a new random video."),t.videos.knownVideos[T]=t.videos.unknownType[T],delete t.videos.unknownType[T],x.splice(x.indexOf(T),1),A--,e.next=85;break;case 84:throw new i.Zi({code:"RYV-11B",message:"An unknown error occurred while testing if the video ".concat(T," should be included in the shuffle."),solveHint:"Please contact the developer, as this should not happen.",showTrace:!1,canSavePlaylist:!1});case 85:e.next=89;break;case 87:k.push(T),x.splice(x.indexOf(T),1);case 89:e.next=93;break;case 91:k.push(T),x.splice(x.indexOf(T),1);case 93:A++,e.next=25;break;case 96:if(0!==k.length){e.next=98;break}throw new i.Zi({code:"RYV-6B",message:"All previously uploaded videos on this channel were deleted (the channel does not have any uploads) or you are ignoring/only shuffling from shorts and the channel only has/has no shorts.",solveHint:"If you are ignoring shorts, disable the option in the popup to shuffle from this channel.",showTrace:!1,canSavePlaylist:!0});case 98:return console.log("".concat(k.length," random video").concat(k.length>1?"s have":" has"," been chosen: [").concat(k,"]")),e.abrupt("return",{chosenVideos:k,playlistInfo:t,shouldUpdateDatabase:o,encounteredDeletedVideos:P});case 100:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e,t){if(t.videos.unknownType[e])return"unknownType";if(t.videos.knownVideos[e])return"knownVideos";if(t.videos.knownShorts[e])return"knownShorts";throw new i.Zi({code:"RYV-11A",message:"The video that was tested does not exist in the local playlist ".concat(e,", so it's type could not be determined."),solveHint:"Please contact the developer, as this should not happen.",showTrace:!1,canSavePlaylist:!1})}function j(e,t,n,o){var r;switch(n){case"allVideosOption":r=t;break;case"dateOption":if(0===(r=t.filter((function(t){return new Date(e[t])>=new Date(o)}))).length)throw new i.Zi({code:"RYV-8A",message:"There are no videos that were released after the specified date (".concat(o,")."),solveHint:"Please change the date or use a different shuffle filter option.",showTrace:!1,canSavePlaylist:!0});break;case"videoIdOption":var a=t.indexOf(o);if(-1===a)throw new i.Zi({code:"RYV-8B",message:"The video ID you specified (".concat(o,") does not map to a video uploaded on this channel."),solveHint:"Please fix the video ID or use a different shuffle filter option.",showTrace:!1,canSavePlaylist:!0});if(0===(r=t.slice(0,a)).length)throw new i.Zi({code:"RYV-8C",message:"There are no videos that were released after the specified video ID (".concat(o,"), or the newest video has not yet been added to the database."),solveHint:"The extension updates playlists every 48 hours, so please wait for an update, change the video ID used in the filer or use a different filter option.",showTrace:!1,canSavePlaylist:!0});break;case"percentageOption":if(o<1||o>100)throw new i.Zi({code:"RYV-8D",message:"The percentage you specified (".concat(o,"%) should be between 1 and 100. Normally, you should not be able to set such a value."),solveHint:"Please fix the percentage in the popup.",showTrace:!1,canSavePlaylist:!0});r=t.slice(0,Math.max(1,Math.ceil(t.length*(o/100))))}return r}function Z(e,t){return E.apply(this,arguments)}function E(){return(E=(0,a.Z)(s.mark((function e(t,n){var o,r,a,c,l,h,d,f,p,y,v,m,g,b,w,x,k,T;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u.x$.shuffleOpenAsPlaylistOption&&t.length>1?(a=t.join(","),r="https://www.youtube.com/watch_videos?video_ids=".concat(a)):r="https://www.youtube.com/watch?v=".concat(t[0]),e.next=3,chrome.runtime.sendMessage({command:"getAllYouTubeTabs"});case 3:if(e.t1=o=e.sent,e.t0=null!==e.t1,!e.t0){e.next=7;break}e.t0=void 0!==o;case 7:if(!e.t0){e.next=11;break}e.t2=o,e.next=12;break;case 11:e.t2=[];case 12:if(c=e.t2,l=c.find((function(e){return e.id===u.x$.shuffleTabId})),!u.x$.shuffleOpenInNewTabOption||n){e.next=33;break}if("video"===(h=(0,i.Vb)(window.location.href))?(p=null===(d=document.querySelector("ytd-player#ytd-player"))||void 0===d||null===(f=d.children[0])||void 0===f?void 0:f.children[0])&&p.classList.contains("playing-mode")&&!p.classList.contains("unstarted-mode")&&p.children[0].click():"channel"===h?((b=null===(y=document.querySelector("ytd-player#player"))||void 0===y||null===(v=y.children[0])||void 0===v?void 0:v.children[0])&&b.classList.contains("playing-mode")&&!b.classList.contains("unstarted-mode")&&b.children[0].click(),(w=null===(m=document.querySelector("ytd-player#ytd-player"))||void 0===m||null===(g=m.children[0])||void 0===g?void 0:g.children[0])&&w.classList.contains("playing-mode")&&!w.classList.contains("unstarted-mode")&&w.children[0].click()):"short"===h?(T=null===(x=document.querySelector("ytd-player#player"))||void 0===x||null===(k=x.children[0])||void 0===k?void 0:k.children[0])&&T.classList.contains("playing-mode")&&!T.classList.contains("unstarted-mode")&&T.children[0].click():console.log("The current page type (".concat(h,") is not supported when checking if a video player should be paused.")),!u.x$.shuffleReUseNewTabOption||!l){e.next=23;break}return L(),e.next=21,chrome.runtime.sendMessage({command:"openVideoInTabWithId",data:{tabId:u.x$.shuffleTabId,videoUrl:r}});case 21:e.next=31;break;case 23:return window.open(r,"_blank").focus(),e.t3=u.$I,e.next=27,chrome.runtime.sendMessage({command:"getCurrentTabId"});case 27:return e.t4=e.sent,e.next=30,(0,e.t3)("shuffleTabId",e.t4);case 30:L();case 31:e.next=42;break;case 33:if(!n){e.next=40;break}return e.t5=u.$I,e.next=37,chrome.runtime.sendMessage({command:"getCurrentTabId"});case 37:return e.t6=e.sent,e.next=40,(0,e.t5)("shuffleTabId",e.t6);case 40:L(),window.location.assign(r);case 42:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(){return _.apply(this,arguments)}function _(){return(_=(0,a.Z)(s.mark((function e(){var t;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(3!==(t=new Date).getMonth()||1!==t.getDate()||u.x$.wasLastRickRolledInYear===String(t.getFullYear())){e.next=5;break}return e.next=4,(0,u.$I)("wasLastRickRolledInYear",String(t.getFullYear()));case 4:window.open("https://www.youtube.com/watch?v=dQw4w9WgXcQ","_blank").focus();case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e){return Object.assign({},e.videos.knownVideos,e.videos.knownShorts,e.videos.unknownType)}function M(e){var t;if(!(e.lastVideoPublishedAt&&e.lastFetchedFromDB&&e.videos&&e.videos.knownVideos&&e.videos.knownShorts&&e.videos.unknownType))throw new i.Zi({code:"RYV-10",message:"The playlistInfo object is missing one or more required keys (Got: ".concat(Object.keys(e),", videos key: ").concat(null!==(t=Object.keys(e.videos))&&void 0!==t?t:"No keys",")."),solveHint:"Please try again and inform the developer if the error is not resolved.",showTrace:!1,canSavePlaylist:!1});e.newVideos||(e.newVideos={})}function C(e,t,n){e.id.includes("large-shuffle-button")||"fetchPercentageNoticeShufflingPage"==e.id?e.innerText=t:(["shuffle","close"].includes(n)?(0,i.BO)(e,!1):(0,i.BO)(e,!0),e.innerText=n)}function F(e){return H.apply(this,arguments)}function H(){return H=(0,a.Z)(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,chrome.storage.local.get([t]).then(function(){var e=(0,a.Z)(s.mark((function e(n){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n[t]){e.next=6;break}if(void 0!==n[t].videos){e.next=5;break}return e.next=4,chrome.storage.local.remove([t]);case 4:case 6:return e.abrupt("return",{});case 5:return e.abrupt("return",n[t]);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),H.apply(this,arguments)}function U(e,t){return $.apply(this,arguments)}function $(){return($=(0,a.Z)(s.mark((function e(t,n){var o,a,i,u;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Saving playlist to local storage..."),u={lastAccessedLocally:(new Date).toISOString(),lastFetchedFromDB:null!==(o=n.lastFetchedFromDB)&&void 0!==o?o:new Date(0).toISOString(),lastVideoPublishedAt:null!==(a=n.lastVideoPublishedAt)&&void 0!==a?a:new Date(0).toISOString().slice(0,19)+"Z",videos:null!==(i=n.videos)&&void 0!==i?i:{}},e.next=4,chrome.storage.local.set((0,r.Z)({},t,u));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}u=(c.then?(await c)():c)[0],o()}catch(N){o(N)}}))},385:(e,t,n)=>{"use strict";n.d(t,{Zi:()=>k,VU:()=>T,TR:()=>x,gw:()=>g,xA:()=>w,Vb:()=>y,xb:()=>b,of:()=>v,BO:()=>m});var o=n(142);function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(0,o.Z)(r.key),r)}}function a(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}var c=n(2);function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function h(e,t,n){return h=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct.bind():function(e,t,n){var o=[null];o.push.apply(o,t);var r=new(Function.bind.apply(e,o));return n&&i(r,n.prototype),r},h.apply(null,arguments)}function d(e){var t="function"==typeof Map?new Map:void 0;return d=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,o)}function o(){return h(e,arguments,l(this).constructor)}return o.prototype=Object.create(e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),i(o,e)},d(e)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=l(e);if(t){var r=l(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return function(e,t){if(t&&("object"===(0,c.Z)(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,n)}}var p=console.log;function y(e){var t,n,o;if(!e)return null;var r=e.split("/");return null!==(t=r[2])&&void 0!==t&&t.includes("youtube")?null!==(n=r[3])&&void 0!==n&&n.startsWith("watch?v=")?"video":null!==(o=r[3])&&void 0!==o&&o.startsWith("shorts")?"short":"channel":null}function v(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){return!0};g(n).then((function(){o()&&(e.innerText=t)}))}function m(e,t){e.style.fontSize=t?"12px":"",e.style.position=t?"absolute":"",e.style.top=t?"50%":"",e.style.left=t?"50%":"",e.style.transform=t?"translate(-50%, -50%)":"",e.style.alignItems=t?"center":"",e.style.justifyContent=t?"center":"",e.style.display=t?"flex":"",t?e.classList.remove("material-symbols-outlined"):e.classList.add("material-symbols-outlined")}function g(e){return new Promise((function(t){return setTimeout(t,e)}))}function b(e){return 0===Object.keys(e).length}function w(e){return Object.keys(null!=e?e:{}).length}function x(e,t){return new Date(e.getTime()+36e5*t)}console.log=function(){"[random-youtube-video]:"!==arguments[0]&&Array.prototype.unshift.call(arguments,"[random-youtube-video]:"),p.apply(this,arguments)};var k=function(e){u(n,e);var t=f(n);function n(e){var o,r=e.code,a=void 0===r?"RYV-0":r,i=e.message,u=void 0===i?"":i,c=e.solveHint,l=void 0===c?"":c,h=e.showTrace,d=void 0===h||h,f=e.canSavePlaylist,p=void 0!==f&&f;return s(this,n),(o=t.call(this,u)).code=a,o.message=u,o.solveHint=l,o.showTrace=d,o.canSavePlaylist=p,o.name="RandomYoutubeVideoError",o}return a(n)}(d(Error)),T=function(e){u(n,e);var t=f(n);function n(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"YAPI-0",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",u=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],c=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return s(this,n),(e=t.call(this,r)).code=o,e.message=r,e.reason=a,e.solveHint=i,e.showTrace=u,e.canSavePlaylist=c,e.name="YoutubeAPIError",e}return a(n)}(k)}},a={};function s(e){var t=a[e];if(void 0!==t)return t.exports;var n=a[e]={exports:{}};return r[e](n,n.exports,s),n.exports}e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",n="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",o=e=>{e&&!e.d&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},s.a=(r,a,s)=>{var i;s&&((i=[]).d=1);var u,c,l,h=new Set,d=r.exports,f=new Promise(((e,t)=>{l=t,c=e}));f[t]=d,f[e]=e=>(i&&e(i),h.forEach(e),f.catch((e=>{}))),r.exports=f,a((r=>{var a;u=(r=>r.map((r=>{if(null!==r&&"object"==typeof r){if(r[e])return r;if(r.then){var a=[];a.d=0,r.then((e=>{s[t]=e,o(a)}),(e=>{s[n]=e,o(a)}));var s={};return s[e]=e=>e(a),s}}var i={};return i[e]=e=>{},i[t]=r,i})))(r);var s=()=>u.map((e=>{if(e[n])throw e[n];return e[t]})),c=new Promise((t=>{(a=()=>t(s)).r=0;var n=e=>e!==i&&!h.has(e)&&(h.add(e),e&&!e.d&&(a.r++,e.push(a)));u.map((t=>t[e](n)))}));return a.r?c:s()}),(e=>(e?l(f[n]=e):c(d),o(i)))),i&&(i.d=0)},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s(551)})();